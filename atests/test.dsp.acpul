### 5250 test.dsp

r0:=k==0;

draw(r0, 5251);

# DSP [

_ @1010;
_ @sys.dsp;

_ @1010;
_ @sys.llog;

ll0 r0;
llog.begin(ll0, S.livelogging.tests);
llog.begin(ll0, test.dsp);
llog.erase(ll0, 0);
llog.print(ll0, S.TEST.DSP);

# generator [

dsp.module.generator.create2 {
 # m0dule, info :: dsp.default.module.generator.info
 _0:=dsp.module.create(dsp.module.type.generator);
 ps dsp.module.prop.set(__);
 p dsp.module.props.generator;

 ps(_0, p.type, _1.type);
 ps(_0, p.frequency, _1.frequency);
 ps(_0, p.amplitude, _1.amplitude);
 ps(_0, p.envelope.attack, _1.envelope.attack);
 ps(_0, p.envelope.decay, _1.envelope.decay);
 ps(_0, p.envelope.sustain, _1.envelope.sustain);
 ps(_0, p.envelope.release, _1.envelope.release);
};

dsp.default.module.generator.info {
 p dsp.module.props.generator;
 type p.types.sine;
 frequency 1;
 amplitude 0.5;
 envelope {
  attack 0.1;
  decay 0.2;
  sustain 0.1;
  release 0.1;
 };
 add.harmonic module.generator.create.harmonic(__);
 mixer.volume module.mixer.volume(__);
 new module.generator.create2(__);
};

dsp.module.delay.create {
 # m0dule, info :: delay.info
 _0:=dsp.module.create(dsp.module.type.delay);
 ps dsp.module.prop.set(__);
 ps(_0, p.repeats, _1.repeats);
 ps(_0, p.amplitude.drop, _1.amplitude.drop);
 ps(_0, p.delay.time, _1.delay.time); 
};

# generator ]

dsp.default.module.delay.info {
 repeats 1;
 amplitude.drop 0.2;
 delay.time 1;
};

# A [

am0 r15;
gen0 { _ dsp.default.module.generator.info;
 type p.types.saw;
};
if (r0) {
 gen0.new(am0, gen0);
 gen0.add.harmonic(am0, 400, 1);
 gen0.mixer.volume(am0, 0.9);
 llog.printv(ll0, S.gen0, r15);
};

# A ]
# B [

gen1 { _ dsp.default.module.generator.info;
 type p.types.sine;
 self r14;
 new(self, gen1);
 add.harmonic(self, 400, 1);
 mixer.volume(self, 0.9);
};
if (r0) {
 gen1; # THE BEST!!! mean 'define gen1'
 llog.printv(ll0, S.gen1, r14);
};

# B ]
# C [

dly1 { _ dsp.default.module.delay.info;
 self r12;
 dsp.module.delay.create(self, dly1);
};
dly1;
#dsp.module.delay.create(dly1, 0, 100, 101);

# C ]
# DSP ]

llog.end(ll0);
llog.end(ll0);

x:=100;

t+=dt;

k:=1;

### 5251 test.dsp.draw

color(u0, 0,0,1,0.9);
rect(u0, 2, 0,0, 270,145);

fx sin((_0+0.5)*pi/2+t)*25;
fy cos((_0+0.5)*pi/2+t)*25;
r 15;

color(u0, 0.5,0.0,0.2,0.5);
circle(u0, 6, fx(0),fy(0), r, 0, 8, 0);
color(u0, 0.0,0.5,0.2,0.5);
circle(u0, 6, fx(1),fy(1), r, 0, 8, 0);
color(u0, 0.2,0.0,0.5,0.5);
circle(u0, 6, fx(2),fy(2), r, 0, 8, 0);
color(u0, 0.0,0.5,0.9,0.5);
circle(u0, 6, fx(3),fy(3), r, 0, 8, 0);
