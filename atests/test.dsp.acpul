### 5250 test.dsp

r0:=k==0;

draw(r0, 5251);

# DSP [

_ @1010;
_ @sys.dsp;

_ @1010;
_ @sys.llog;

ll0 r0;
llog.begin(ll0, S.livelogging.tests);
llog.begin(ll0, test.dsp);
llog.erase(ll0, 0);
llog.print(ll0, S.TEST.DSP);

# generator [

dsp.module.generator.create2 {
 # m0dule, info :: dsp.default.module.generator.info
 _0:=dsp.module.create(dsp.module.type.generator);
 ps dsp.module.prop.set(__);
 p dsp.module.props.generator;
 ps(_0, p.type, _1.type);
 ps(_0, p.frequency, _1.frequency);
 ps(_0, p.amplitude, _1.amplitude);
 ps(_0, p.envelope.attack, _1.envelope.attack);
 ps(_0, p.envelope.decay, _1.envelope.decay);
 ps(_0, p.envelope.sustain, _1.envelope.sustain);
 ps(_0, p.envelope.release, _1.envelope.release);
};

dsp.default.module.generator.info {
 p dsp.module.props.generator;
 type p.types.sine;
 frequency 1;
 amplitude 0.5;
 envelope {
  attack 0.1;
  decay 0.2;
  sustain 0.1;
  release 0.1;
 };
 add.harmonic module.generator.create.harmonic(__);
 mixer.volume module.mixer.volume(__);
 new module.generator.create2(__);
};

# generator ]
# delay [

dsp.module.delay.create {
 # m0dule, repeats, amplitude.drop, delay
 _0:=dsp.module.create(dsp.module.type.delay);
 ps dsp.module.prop.set(__);
 p dsp.module.props.delay; 
 ps(_0, p.repeats, _1);
 ps(_0, p.amplitude.drop, _2);
 ps(_0, p.delay.time, _3); 
};

dsp.module.delay.create2 {
 # m0dule, info :: dsp.default.module.delay.info
# _0:=dsp.module.create(dsp.module.type.delay);
# ps dsp.module.prop.set(__);
# p dsp.module.props.delay; 
 dsp.module.delay.create(_0, _1.repeats, _1.amplitude.drop, _1.delay.time);
};

dsp.default.module.delay.info {
 repeats 1;
 amplitude.drop 0.2;
 delay.time 1;
 new dsp.module.delay.create2(__);
};

# delay ]
# filter [

dsp.module.filter.create {
 # m0dule, frequency, bandwidth, gain, type
 _0:=dsp.module.create(dsp.module.type.filter);
 ps dsp.module.prop.set(__);
 p dsp.module.props.filter; 
 ps(_0, p.frequency, _1);
 ps(_0, p.bandwidth, _2);
 ps(_0, p.gain, _3); 
 ps(_0, p.type, _4); 
};

dsp.module.filter.create2 {
 # m0dule, info :: dsp.default.module.filter.info
 dsp.module.filter.create2(_0, _1.frequency, _1.bandwidth, _1.gain, _1.type);
};

dsp.default.module.filter.info {
 frequency 1000;
 bandwidth 500;
 gain 0.5;
 type 1000;
 new dsp.module.filter.create2(__);
};

# filter ]
# A [

am0 r15;
gen0 { _ dsp.default.module.generator.info;
 type p.types.saw;
};
if (r0) {
 gen0.new(am0, gen0);
 gen0.add.harmonic(am0, 400, 1);
 gen0.mixer.volume(am0, 0.9);
 llog.printv(ll0, S.gen0, r15);
};

# A ]
# B [

gen1 { _ dsp.default.module.generator.info;
 type p.types.sine;
 self r14;
 new(self, gen1);
 add.harmonic(self, 400, 1);
 mixer.volume(self, 0.9);
};
if (r0) {
 gen1; # THE BEST!!! mean 'define gen1'
 llog.printv(ll0, S.gen1, r14);
};

# B ]
# C [

dly1 { _ dsp.default.module.delay.info;
 repeats 3;
 amplitude.drop 0.5;
 self r12;
 new(self, dly1);
};
if (r0) {
 dly1;
 llog.printv(ll0, S.dly1, r12);

 dsp.module.delay.create(r11, 2, 0.1, 1);
 llog.printv(ll0, S.delay.short, r11);
};


# C ]
# D [

filt1 { _ dsp.default.module.filter.info;
 frequency 3;
 self r10;
 new(self, filt1);
};
if (r0) {
 filt1;
 llog.printv(ll0, S.filt1, r10);

 dsp.module.filter.create(r9, 1000, 500, 0.5, 1000);
 llog.printv(ll0, S.filter.short, r9);
};

# D ]
# DSP ]

llog.end(ll0);
llog.end(ll0);

x:=100;

t+=dt;

k:=1;

### 5251 test.dsp.draw

color(u0, 0,0,1,0.9);
rect(u0, 2, 0,0, 270,145);

fx sin((_0+0.5)*pi/2+t)*25;
fy cos((_0+0.5)*pi/2+t)*25;
r 15;

color(u0, 0.5,0.0,0.2,0.5);
circle(u0, 6, fx(0),fy(0), r, 0, 8, 0);
color(u0, 0.0,0.5,0.2,0.5);
circle(u0, 6, fx(1),fy(1), r, 0, 8, 0);
color(u0, 0.2,0.0,0.5,0.5);
circle(u0, 6, fx(2),fy(2), r, 0, 8, 0);
color(u0, 0.0,0.5,0.9,0.5);
circle(u0, 6, fx(3),fy(3), r, 0, 8, 0);
