### 5400 test.media.texture

r0:=k==0;

draw(r0, 5401);

_ @1010;
_ @sys.media;

tex r8;
recording r5;

if (r0) {
 pool 5400;
 id 0;
# tex:=media.video.recorder.texture(r0, pool,id, 0, 640,480);
 tex:=media.video.recorder.texture(r0, pool,id, 0, 768,1024/2);
# tex:=media.video.recorder.texture(r0, pool,id, 0, 800/2,150/2+10);
# tex:=media.video.recorder.texture(r0, pool,id, 0, 800,150);
 recording+=1;
};

#if (t > 150) {
if (t > 60) {
#if (t > 1) {
#if (t > 10) {
 media.video.recorder.stop(recording, tex);
 recording:=0;
};

_ @sys.node;

n0 r6;

if (r0) {
# BIRD 7340;
# r6:=node.new.this.ex(r0, BIRD, 1);
# AWESOME.NOTES 10010000;
# r6:=node.new.this.ex(r0, AWESOME.NOTES, 0);
# ACPU.STUDIO 10019000;
# r6:=node.new.this.ex(r0, ACPU.STUDIO, 0);
# LIVECOMMENT 10018000;
# r6:=node.new.this.ex(r0, LIVECOMMENT, 0);
# TEST.TEXT 5300;
# r6:=node.new.this.ex(r0, TEST.TEXT, 0);

 _ @1010; _ @sys.llog; llog.b(Q.test.media.texture); llog.erase(u0, 0); llog.pv(Q.r6, r6); llog.e();
};

anotes.position {
# node.prop.s.s(u0, n0, 0.2);
# node.prop.x.s(u0, n0, 200-cos(t)*50);
# node.prop.y.s(u0, n0, 200+sin(t)*50);
 node.prop.x.s(u0, n0, -50);
 node.prop.y.s(u0, n0, -100);
 node.prop.s.s(u0, n0, 0.95);
};
#anotes.position;
livecomment.position {
# node.prop.x.s(u0, n0, -50);
# node.prop.y.s(u0, n0, -100);
 node.prop.s.s(u0, n0, 0.25);
};
#livecomment.position;

t+=dt;

k:=1;

### 5401 test.media.texture.draw

color(u0, 1,0,0,1);
form {
 x0 0+50*_0;
 y0 0+50*_0;
 x1 50+50*_0;
 y1 50+50*_0+rnd(u0)*50;
 x2 100+50*_0;
 y2 0+50*_0;
 n 0;m 0;triangle(u0, 6, x0(n),y0(m), x1(n),y1(m), x2(n),y2(m));
 n 1;m 1;triangle(u0, 6, x0(n),y0(m), x1(n),y1(m), x2(n),y2(m));
 n 2;m 0;triangle(u0, 6, x0(n),y0(m), x1(n),y1(m), x2(n),y2(m));
 n 3;m 0;triangle(u0, 6, x0(n),y0(m), x1(n),y1(m), x2(n),y2(m));
 n 4;m 1;triangle(u0, 6, x0(n),y0(m), x1(n),y1(m), x2(n),y2(m));
 n 5;m 0;triangle(u0, 6, x0(n),y0(m), x1(n),y1(m), x2(n),y2(m));
 n 2.5;m 1.7;triangle(u0, 6, x0(n),y0(m), x1(n),y1(m), x2(n),y2(m));
};
form;

_ @1010;
_ @sys.node;
_ @sys.media;

tex r8;
recording r5;

draw.boot {
 dma0 0;
 sharedobj.key(u0, dma0,1000);
 l0:=dma.get(u0, dma0,0);
# node.ex.gl.node.set.draw.transform(u0, 0,0, 0, 0.5);
 node.ex.gl.node.draw(u0, l0);
};

record.frame {
 l0:=node.ex.is.this.drawing(u0);
# watch(l0);
 if (l0 == 0) {
#  l0:=77;
# watch(l0);
  draw.self:=1;
  node.ex.gl.fbo(u0, tex);

  node.ex.gl.clear(u0, 0,0,0,0);  
# node.ex.gl.clear(u0, 1,1,0,1);
# node.ex.gl.clear(u0, rnd(u0),rnd(u0),rnd(u0),1);  

#  form;
  draw.boot;

#  node.ex.gl.child.draw(u0);

  node.ex.gl.fbo(u0, -1);

  media.video.recorder.frame.ready(u0, tex, dt);
 };
};

_ @sys.sharedobj;
_ @sys.obj;


if (recording) {
 record.frame;
};
