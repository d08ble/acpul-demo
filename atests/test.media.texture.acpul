### 5400 test.media.texture

r0:=k==0;

draw(r0, 5401);

_ @1010;
_ @sys.media;

tex r8;
recording r5;

if (r0) {
 pool 5400;
 id 0;
 tex:=media.video.recorder.texture(r0, pool,id, 0, 640,480);
 recording+=1;
};

t+=dt;

k:=1;

### 5401 test.media.texture.draw

color(u0, 1,0,0,1);
x0 0+50*_0;
y0 0+50*_0;
x1 50+50*_0;
y1 50+50*_0+rnd(u0)*50;
x2 100+50*_0;
y2 0+50*_0;
n 0;m 0;triangle(u0, 6, x0(n),y0(m), x1(n),y1(m), x2(n),y2(m));
n 1;m 1;triangle(u0, 6, x0(n),y0(m), x1(n),y1(m), x2(n),y2(m));
n 2;m 0;triangle(u0, 6, x0(n),y0(m), x1(n),y1(m), x2(n),y2(m));

n 3;m 0;triangle(u0, 6, x0(n),y0(m), x1(n),y1(m), x2(n),y2(m));
n 4;m 1;triangle(u0, 6, x0(n),y0(m), x1(n),y1(m), x2(n),y2(m));
n 5;m 0;triangle(u0, 6, x0(n),y0(m), x1(n),y1(m), x2(n),y2(m));

n 2.5;m 1.7;triangle(u0, 6, x0(n),y0(m), x1(n),y1(m), x2(n),y2(m));

_ @1010;
_ @sys.node;
_ @sys.media;

tex r8;
recording r5;

record.frame {
 node.ex.gl.fbo(u0, tex);

 node.ex.gl.clear(u0, rnd(u0),rnd(u0),rnd(u0),1);  

 node.ex.gl.fbo(u0, -1);

 media.video.recorder.frame.ready(u0, tex, dt);
};

if (t < 1) {
 record.frame;
};
if (t > 1) {
 media.video.recorder.stop(recording, tex);
 recording:=0;
 watch(recording);
};
