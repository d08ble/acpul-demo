### 5500 monitor
# p0 - mode: 0-mem 1-disk 2-battery

r0:=k==0;

draw(r0, 5501);

_ @1010;
_ @sys.obj;
_ @sys.cpu;

dma0 0;
points r1;
size 50;

if (r0) {
 points:=buffer.new(u0, size+1, size+1);
};
#l0:=buffer.new(u0, 100000, 10000000);
#buffer.dma(u0, dma0, l0,0);
#dma.set(u0, dma0, 100000-1, rnd(u0));
#i:=0;while(i<100000){
# dma.set(u0, dma0, i, rnd(u0));
# i+=1;
#};

buffer.dma(u0, dma0, points,0);

# dma.push() - todo: refactor [

i:=0;while(i<size-1){
 l0:=dma.get(u0, dma0, i+1);
 dma.set(u0, dma0, i, l0);
 i+=1;
};

battery {
 l0:=cpu.get.battery.info(u0);
 level o1;
 dma.set(u0, dma0, size-1, level);
};
disk {
 l0:=cpu.get.disk.info(u0);
 total o0;
 free o1;
 ratio free/total;
 dma.set(u0, dma0, size-1, 1-ratio);
};
memory {
 l0:=cpu.get.memory.info(u0);
 total o0;
 free o1;
 used o2;
 ratio free/total;
 dma.set(u0, dma0, size-1, 1-ratio);
};
if (p0==0) {memory;};
if (p0==1) {disk;};
if (p0==2) {battery;};

# dma.push() - todo: refactor ]

#if (t<60) {
#  if (r2==0) {
#   dma.dump(u0, 0, 0);
#   r2:=120;
#  };
#};
#r2-=r2!=0;

dma.off(u0, 0);

t+=dt;
x:=500;
k:=1;

### 5501 monitor.draw

#color(u0, 0.2,0.5,0,0.1);
color(u0, 1,1,0,0.1);
x0 10;
y0 0;
rw 100;
rh 100;
rect(u0, 6, x0,y0,rw,rh);
l 0.5+dt*10;
r 0.5+dt*2;
psize(u0, 1);
color(u0, l,r,r,1);
rect(u0, 2, x0,y0,rw,rh);
rect(u0, 2, x0-2,y0-2,rw+4,rh+4);
rect(u0, 2, x0-4,y0-4,rw+8,rh+8);
rect(u0, 2, x0-6,y0-6,rw+12,rh+12);

color(u0, 1,0.5,0.2,1);

_ @1010;
_ @sys.obj;

dma0 0;
points r1;

buffer.dma(u0, dma0, points,0);

fill {
 size 50;
 i:=0;while(i<size){
  py dma.get(u0, dma0, i);
  #point(u0, i,py*100);
  h rh-2;
  point(u0,x0+i*rw/size,y0+py*h);
#  line(u0,3,x0+i*rw/size,y0+py*h,x0+i*rw/size,y0);
  i+=1;
 };
};
fill;

dma.off(u0, 0);


### 5502 monitor.memory

r0:=k==0;

draw(r0, 5503);

k:=1;

### 5503 monitor.memory.draw

### 5504 monitor.performance

r0:=k==0;

draw(r0, 5505);

k:=1;

### 5505 monitor.performance.draw
