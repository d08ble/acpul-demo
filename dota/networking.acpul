### 3290 Networking
# r0, r1

r0:=k==0;

draw(r0, 3291);


_ @1010;
_ @sys.net;

l0:=net.is.connected(u0);
if (l0)
{
 if (r1==0) {
  r1:=1;
  net.started(u0);
 };
};
if (l0==0)
{
 r1:=0;
};

_ @3299;

this.turn.received l7;
this.turn.sended l8;

if(net.is.setup.event(u0))
{
 gnet.id:=net.get.index(u0);
 gnet.frame:=0;
 gt:=0;
 glt:=0;
 this.turn.sended:=0;
 this.turn.received:=0;
};

net.t.max 0.2;
net.t.send 0.1;

# game time [

if (glt+dt > net.t.max)
{
 if (this.turn.received) {
  this.turn.received:=0;
  glt:=0;
  this.turn.sended:=0;
 };
};

gdt:=min(net.t.max-glt, dt);
gt+=gdt;

if (glt < net.t.max) 
{
 glt+=gdt;
 watch(glt);
};

# game time ]

gnet.mem.wr.a 8825;
gnet.mem.rd.a 8827;

gnet.mem.wr.p l9;
gnet.mem.rd.p l10;

# send [

if (this.turn.sended==0)
{
 if (glt>net.t.send) 
 {
  this.turn.sended:=1;
  net.send.mem(u0, 0, gnet.mem.wr.a);
 };
};

# send ]

# recv [

if (net.is.sync.event(u0)>0)
{
 net.recv.mem(u0, 0, gnet.mem.rd.a);
 this.turn.received:=1;
};

# recv ]

k:=1;

### 3291 Networking.draw

#watch(r0);

color(u0, 1,1,0,0);
rect(u0, 2, 0,0,64,32);

color(u0, 0.7,0.5,0,0);
rect(u0, 6, 8,8,8,8);

